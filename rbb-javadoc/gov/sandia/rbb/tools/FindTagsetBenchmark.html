<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_27) on Wed Jul 10 23:23:36 MDT 2013 -->
<TITLE>
FindTagsetBenchmark
</TITLE>

<META NAME="date" CONTENT="2013-07-10">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="FindTagsetBenchmark";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../gov/sandia/rbb/tools/FindEventSequences.html" title="class in gov.sandia.rbb.tools"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../gov/sandia/rbb/tools/Get.html" title="class in gov.sandia.rbb.tools"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html?gov/sandia/rbb/tools/FindTagsetBenchmark.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="FindTagsetBenchmark.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
gov.sandia.rbb.tools</FONT>
<BR>
Class FindTagsetBenchmark</H2>
<PRE>
java.lang.Object
  <IMG SRC="../../../../resources/inherit.gif" ALT="extended by "><B>gov.sandia.rbb.tools.FindTagsetBenchmark</B>
</PRE>
<HR>
<DL>
<DT><PRE>public class <B>FindTagsetBenchmark</B><DT>extends java.lang.Object</DL>
</PRE>

<P>
This class is being created as a benchmark for H2STagset.find which
 has been determined by profiling to be unacceptably slow.


 In the version checked in 2011 Fri Aug 19 1:25pm:
  Entering runTest
  FindTagsetBenchmark(100) took 11 milliseconds per tagset creation.
    Entering runTest
    FindTagsetBenchmark(200) took 9 milliseconds per tagset creation.
    Entering runTest
    FindTagsetBenchmark(300) took 13 milliseconds per tagset creation.
    Entering runTest
    FindTagsetBenchmark(400) took 15 milliseconds per tagset creation.
    Entering runTest
    FindTagsetBenchmark(500) took 18 milliseconds per tagset creation.
    Entering runTest
    FindTagsetBenchmark(1000) took 42 milliseconds per tagset creation.
 
 Using the profiler takes 5m 46s to run:
 
 FindTagsetBenchmark(200) took 1712 milliseconds per tagset creation.

 This benchmark calls H2STagset.toID.
 Initial version spends 98.4% of its time in H2STagset.find
 which is BAD since retrieving Events by tagset is so central to RBB.

 Is the query formed by H2STagset.hasTagsQuery even indexed?

 It appears that finding the tagset id by name and value is indexed:

 explain select TAGSET_ID from RBB_TAGSETS where NAME_ID=RBB_STRING_FIND_ID('name22') and VALUE_ID=RBB_STRING_FIND_ID('value64') intersect
 select TAGSET_ID from RBB_TAGSETS where NAME_ID=RBB_STRING_FIND_ID('name25') and VALUE_ID=RBB_STRING_FIND_ID('value32');
PLAN
(SELECT TAGSET_ID
FROM PUBLIC.RBB_TAGSETS /* PUBLIC.PRIMARY_KEY_4: NAME_ID = PUBLIC.RBB_STRING_FIND_ID('name22') AND VALUE_ID = PUBLIC.RBB_STRING_FIND_ID('value64')
WHERE (NAME_ID = PUBLIC.RBB_STRING_FIND_ID('name22')) AND (VALUE_ID = PUBLIC.RBB_STRING_FIND_ID('value64'))) INTERSECT (SELECT TAGSET_ID
FROM PUBLIC.RBB_TAGSETS /* PUBLIC.PRIMARY_KEY_4: NAME_ID = PUBLIC.RBB_STRING_FIND_ID('name25') AND VALUE_ID = PUBLIC.RBB_STRING_FIND_ID('value32')
WHERE (NAME_ID = PUBLIC.RBB_STRING_FIND_ID('name25')) AND (VALUE_ID = PUBLIC.RBB_STRING_FIND_ID('value32')))
(1 row, 1 ms)

 Is it the part that finds all tagsets with AT LEAST the specified tags (hasTagsQuery)
 or the part that narrows that down to the one with EXACTLY the specified number of tags that's messed up?

 Do all the calls to string_find_id have a big effect?

 This query takes about 70 ms for 1 invocation!  468 on first invocation, 123 on second, then about 70.
 call rbb_tagset_find_id(('name22', 'value91', 'name24', 'value97', 'name52', 'value52', 'name6', 'value44', 'name96', 'value27'));

 CREATE ALIAS has_tags_query FOR "gov.sandia.rbb.impl.h2.statics.H2STagset.hasTagsQuery";


  select TAGSET_ID from RBB_TAGSETS where NAME_ID=RBB_STRING_FIND_ID('name22')and VALUE_ID=RBB_STRING_FIND_ID('value91') intersect
  select TAGSET_ID from RBB_TAGSETS where NAME_ID=RBB_STRING_FIND_ID('name24')and VALUE_ID=RBB_STRING_FIND_ID('value97') intersect
  select TAGSET_ID from RBB_TAGSETS where NAME_ID=RBB_STRING_FIND_ID('name52')and VALUE_ID=RBB_STRING_FIND_ID('value52') intersect
  select TAGSET_ID from RBB_TAGSETS where NAME_ID=RBB_STRING_FIND_ID('name6')and VALUE_ID=RBB_STRING_FIND_ID('value44') intersect
  select TAGSET_ID from RBB_TAGSETS where NAME_ID=RBB_STRING_FIND_ID('name96')and VALUE_ID=RBB_STRING_FIND_ID('value27');

 whoah, the hasTagsQuery is taking 1 ms and the tagset_find_id is taking 58-100!!!  

 select rbb_id_to_tagset(tagset_id) from (select distinct tagset_id from rbb_tagsets);

 Now re-run the benchmark:

 Entering runTest
    FindTagsetBenchmark(100) took 4 milliseconds per tagset creation.
    Entering runTest
    FindTagsetBenchmark(200) took 1 milliseconds per tagset creation.
    Entering runTest
    FindTagsetBenchmark(300) took 0 milliseconds per tagset creation.
    Entering runTest
    FindTagsetBenchmark(400) took 0 milliseconds per tagset creation.
    Entering runTest
    FindTagsetBenchmark(500) took 0 milliseconds per tagset creation.
    Entering runTest
    FindTagsetBenchmark(1000) took 0 milliseconds per tagset creation.

 Yes!!!!!
<P>

<P>
<HR>

<P>

<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../../gov/sandia/rbb/tools/FindTagsetBenchmark.html#FindTagsetBenchmark()">FindTagsetBenchmark</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../gov/sandia/rbb/tools/FindTagsetBenchmark.html#main(java.lang.String[])">main</A></B>(java.lang.String[]&nbsp;args)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class java.lang.Object</B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="FindTagsetBenchmark()"><!-- --></A><H3>
FindTagsetBenchmark</H3>
<PRE>
public <B>FindTagsetBenchmark</B>()</PRE>
<DL>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="main(java.lang.String[])"><!-- --></A><H3>
main</H3>
<PRE>
public static void <B>main</B>(java.lang.String[]&nbsp;args)
                 throws java.lang.Exception</PRE>
<DL>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE>java.lang.Exception</CODE></DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../gov/sandia/rbb/tools/FindEventSequences.html" title="class in gov.sandia.rbb.tools"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../gov/sandia/rbb/tools/Get.html" title="class in gov.sandia.rbb.tools"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html?gov/sandia/rbb/tools/FindTagsetBenchmark.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="FindTagsetBenchmark.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
